"use strict";
// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at http://mozilla.org/MPL/2.0/.
/**
 * Responsible for checking if all new patches have been applied
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.patchCheck = exports.patchCountFile = void 0;
const fs_1 = require("fs");
const path_1 = require("path");
const log_1 = require("../log");
const constants_1 = require("../constants");
const utils_1 = require("../utils");
exports.patchCountFile = (0, path_1.resolve)(constants_1.MELON_DIR, 'patchCount');
const patchCheck = async () => {
    const fileList = (await (0, utils_1.walkDirectory)((0, path_1.resolve)(constants_1.SRC_DIR))).filter((file) => file.endsWith('.patch'));
    const patchCount = fileList.length;
    if (!(0, fs_1.existsSync)(exports.patchCountFile)) {
        (0, fs_1.writeFileSync)(exports.patchCountFile, '0');
    }
    const recordedPatchCount = Number((0, fs_1.readFileSync)(exports.patchCountFile).toString());
    if (patchCount !== recordedPatchCount) {
        await log_1.log.hardWarning('You have not imported all of your patches. This may lead to unexpected behavior');
    }
};
exports.patchCheck = patchCheck;
